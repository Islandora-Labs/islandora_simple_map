<?php

/**
 * @file
 * Hooks tests.
 */

/**
 * Class IslandoraSimpleMapHookTestCase.
 */
class IslandoraSimpleMapHookTestCase extends IslandoraSimpleMapTestCase {

  /**
   * Test objects to be removed after the test.
   *
   * @var array
   */
  protected $testObjects = array(
    'test:simpleMapDecimalObject',
  );

  /**
   * Gets info to display to describe this test.
   *
   * @see IslandoraUnitTestCase::getInfo()
   */
  public static function getInfo() {
    return [
      'name' => 'Islandora Simple Map - Hooks',
      'description' => 'Ensure that the hooks for coordinate retrieval/parsing are called.',
      'group' => 'Islandora Simple Map',
    ];
  }

  /**
   * {@inheritdoc}
   */
  public function setUp() {
    parent::setUp('islandora_simple_map_hooks_test');
    module_load_include('inc', 'islandora_simple_map', 'includes/utilities');
  }

  /**
   * Test hook_islandora_simple_map_get_coordinates().
   */
  public function testGetCoordinatesHook() {
    $object = $this->admin->repository->constructObject('test:simpleMapDecimalObject');
    $this->admin->repository->ingestObject($object);
    $mods = $object->constructDatastream('MODS');
    $object->ingestDatastream($mods);

    $object['MODS']->content = file_get_contents("{$this->resourcePath}/mods_single_coordinate.xml");
    $object['MODS']->mimetype = 'application/xml';

    $coord = $object->constructDatastream('COORDS');
    $object->ingestDatastream($coord);
    $object['COORDS']->content = file_get_contents("{$this->resourcePath}/coords_ds_data.txt");
    $object['COORDS']->mimetype = 'text/plain';

    $expected = ['49.8833260,-97.1529213',
      '45.4215, -75.6972',
      '43.6532, -79.3832',
      '45.5017, -73.5673',
      '32째 42\' 56.6496" N, 117째 9\' 39.9132" W',
    ];

    $coords = islandora_simple_map_get_coordinates($object);
    $this->assertEqual($expected, $coords, "Hook get coordinates did not return expected results.");
  }

  /**
   * Test hook_islandora_simple_map_parse_coordinates().
   */
  public function testParseCoordinates() {
    $coordinates = [
      '45.4215, -75.6972',
      '43.6532, -79.3832',
      '45.5017, -73.5673',
      '32째 42\' 56.6496" N, 117째 9\' 39.9132" W',
    ];

    $expected = [
      '45.4215, -75.6972',
      '43.6532, -79.3832',
      '45.5017, -73.5673',
      '32.715736, -117.161087',
    ];

    $new_coords = islandora_simple_map_parse_coordinates($coordinates);
    $this->assertEqual($expected, $new_coords, 'Hook parse coordinates did not return expected results.');
  }

}
